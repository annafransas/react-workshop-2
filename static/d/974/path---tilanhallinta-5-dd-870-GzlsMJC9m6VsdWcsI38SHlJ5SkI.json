{"data":{"markdownRemark":{"html":"<p>Tilanhallinta on keskeinen asia web-sovelluksissa. Sovelluksen tila määrää, mitä sisältöä näytämme milläkin hetkellä. Tila on siis se, mikä erottaa muuttumattomat (ns. staattiset sivut) muuttuvista (ns. dynaamisista) sovelluksista. Reactin tilanhallinnan keskeisimpiä termejä ovat <code class=\"language-text\">props</code> ja <code class=\"language-text\">state</code>. </p>\n<h2>Props</h2>\n<p>Komponenttipohjaisten sovellusten päätarkoitus on se, että jaamme sovelluksemme pieniin osiin, eli komponentteihin, jotka ovat itsenäisiä uudelleenkäytettäviä palikoita joita voimme tarpeidemme mukaan yhdistellä suuremmiksi loogisiksi kokonaisuuksiksi. Törmäämme tässä kuitenkin nopeasti siihen, että meidän tulisi pystyä jotenkin kommunikoimaan ja siirtämään tietoa eri komponenttien välillä.</p>\n<p>Tätä varten React on suunniteltu siten, että komponentit voivat ottaa vastaan tietoa, eli <em>props</em>:eja. Muutetaan aiemmin tekemäämme <code class=\"language-text\">Header</code>-komponenttia ottamaan vastaan propsi nimeltä <code class=\"language-text\">title</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Header</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> title <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>header<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>header<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Header<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Yllä olemme lisänneet funktiokomponentin <code class=\"language-text\">Header</code> parametriksi <code class=\"language-text\">{ title }</code>. Voimme käyttää tätä propsia komponentin palauttamassa HTML:ssä samalla lailla, kirjoittamalla <code class=\"language-text\">{title}</code> elementin <code class=\"language-text\">&lt;header&gt;</code> sisälle.</p>\n<blockquote>\n<p>Tässä vaiheessa käy ilmi, että React-komponentit eivät palauttakaan pelkkää HTML:ää, sillä HTML:lle ei voi antaa muuttuvaa tietoa kuten <code class=\"language-text\">{title}</code> yllä. React-komponentit palauttavatkin <em>JSX</em>:ää, jonka voi ajatella laajentavan HTML:ää. Käytännössä JSX sallii meidän kirjoittavan mitä tahansa JavaScriptiä HTML:n sekaan, kunhan muistamme kääriä JavaScriptin aaltosulkeisiin <code class=\"language-text\">{}</code>. Tämä tekee React-komponenteista todella hyödyllisiä muuttuvan tiedon esittämiseen.</p>\n</blockquote>\n<p>Jotta <code class=\"language-text\">Header</code>-komponentti voisi käyttää propsia <code class=\"language-text\">title</code>, se on jotenkin annettava sille. Propsit välitetään komponentille silloin kun ne lisätään johonkin näkymään. Esimerkiksi kun tällä hetkellä <code class=\"language-text\">App</code>-komponentissa lisäämme komponentin <code class=\"language-text\">&lt;Header /&gt;</code> jotta saamme otsakkeemme näkyviin, niin nyt meidän on lisäksi annettava <code class=\"language-text\">Header</code>-elementille attribuutti nimeltä <code class=\"language-text\">title</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Content <span class=\"token keyword\">from</span> <span class=\"token string\">'./Content'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Header <span class=\"token keyword\">from</span> <span class=\"token string\">'./Header'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Footer <span class=\"token keyword\">from</span> <span class=\"token string\">'./Footer'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"App\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Header title<span class=\"token operator\">=</span><span class=\"token string\">'Karvakuonot'</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Content <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Footer <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Yllä annamme <code class=\"language-text\">Header</code>-elementille attribuutin <code class=\"language-text\">title</code>, jonka arvoksi annamme tekstin <code class=\"language-text\">Karvakuonot</code>. Tämä attribuutti välitetään <code class=\"language-text\">Header</code>-komponentille propsina <code class=\"language-text\">title</code>. Huomaa, että teksti <code class=\"language-text\">Karvakuonot</code> on hipsujen <code class=\"language-text\">&#39;&#39;</code> sisällä, jotta React tietää kyseessä olevan tekstiä (myöhemmin annamme propseille muutakin sisältöä kuin pelkkää tekstiä).</p>\n<p>Olemme siis tehneet <code class=\"language-text\">Header</code>-komponenttiin seuraavan muutoksen: lisäsimme <code class=\"language-text\">Header</code>-komponentille propsin <code class=\"language-text\">title</code>, jota käytämme <code class=\"language-text\">Header</code>-komponentin palauttamassa HTML:ssä. Koska propsia <code class=\"language-text\">title</code> käytetään komponentin HTML:ssä, niin <code class=\"language-text\">Header</code>-komponentin sisältö muuttuu aina kun propsi <code class=\"language-text\">title</code> muuttuu! <code class=\"language-text\">Header</code>-komponentti siis näyttää aina sen tekstin, joka sille <code class=\"language-text\">App</code>-komponentista annetaan.</p>\n<p>Lisäksi lisäsimme <code class=\"language-text\">App</code>-komponentissa <code class=\"language-text\">Header</code>-elementille attribuutin <code class=\"language-text\">title</code>, joka itse asiassa on <code class=\"language-text\">Header</code>-komponentille välitettävä propsi <code class=\"language-text\">title</code>. Toisin sanoen määräämme <code class=\"language-text\">App</code>-komponentista, minkä arvon <code class=\"language-text\">Header</code>-komponentin <code class=\"language-text\">title</code> saa.</p>\n<p>Propsit ovat yksi Reactin oleellisimmista ominaisuuksista, ja ne mahdollistavat saman komponentin käytön eri sisällön esittämiseen; voisimme nyt esimerkiksi luoda useita <code class=\"language-text\">Header</code>-komponentteja, joilla on kaikilla eri sisältö koska voimme välittää eri komponenteille eri <code class=\"language-text\">title</code>-propsit.</p>\n<p><strong>Tehtävä:</strong> Muuta <code class=\"language-text\">Header</code>-komponentti ottamaan vastaan propsi <code class=\"language-text\">title</code>, ja välitä sille otsikkoteksti <code class=\"language-text\">App</code>-komponentista.</p>\n<p>Propseja voidaan käyttää missä tahansa komponentin palauttaman HTML:n sisällä, vaikka elementtien attribuutteina, eikä pelkästään tekstisisältönä. Esimerkiksi kuvitteellisessa komponentissa (jota emme käytä sovelluksessamme) nimeltä <code class=\"language-text\">Avatar</code>, voisimme antaa propsin <code class=\"language-text\">url</code> jota käytämme kuvan näyttämiseen:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Avatar</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> url <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>url<span class=\"token punctuation\">}</span> alt<span class=\"token operator\">=</span><span class=\"token string\">''</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Yllä <code class=\"language-text\">url</code>-propsi annetaan <code class=\"language-text\">img</code>-elementin <code class=\"language-text\">src</code>-attribuutin arvoksi, eli näytettävän kuvan osoite annetaan komponentille propsina (kts. kertauksesta miten HTML:n <code class=\"language-text\">img</code>-elementti toimii jos se ei ole tuttu).</p>\n<p><strong>Tehtävä:</strong> Luo hakemistoon <code class=\"language-text\">src/</code> uusi tiedosto nimeltä <code class=\"language-text\">Button.js</code>. Luo tähän tiedostoon uusi komponentti <code class=\"language-text\">Button</code>, joka saa propsin nimeltä <code class=\"language-text\">icon</code>. Komponentin tulee palauttaa seuraava sisältö:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>icon<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<p><strong>Tehtävä:</strong> Muuta <code class=\"language-text\">Footer</code>-komponentti palauttaman <em>Alalaita</em>-tekstin sijasta kaksi Button-komponenttia, joista toinen saa propsin <code class=\"language-text\">icon</code> arvona <code class=\"language-text\">&#39;heart-broken&#39;</code> ja toinen arvon <code class=\"language-text\">heart</code>.</p>\n<p>Kun ylläolevat tehtävät on valmiit, niin sovelluksen pitäisi näyttää tältä:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bbef46a772905acc5b45694dc017b6f3/8e724/app-with-btns.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 57.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'400\\' height=\\'229\\'%3e%3cpath d=\\'M0 12v12h401V0H0v12m200 197v20h200v-40H200v20\\' fill=\\'%23d3d3d3\\' fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"app_with_btns\"\n        title=\"\"\n        src=\"/static/bbef46a772905acc5b45694dc017b6f3/35c67/app-with-btns.png\"\n        srcset=\"/static/bbef46a772905acc5b45694dc017b6f3/7b5b4/app-with-btns.png 188w,\n/static/bbef46a772905acc5b45694dc017b6f3/d266f/app-with-btns.png 375w,\n/static/bbef46a772905acc5b45694dc017b6f3/35c67/app-with-btns.png 750w,\n/static/bbef46a772905acc5b45694dc017b6f3/1568d/app-with-btns.png 1125w,\n/static/bbef46a772905acc5b45694dc017b6f3/8e846/app-with-btns.png 1500w,\n/static/bbef46a772905acc5b45694dc017b6f3/a60d7/app-with-btns.png 2250w,\n/static/bbef46a772905acc5b45694dc017b6f3/8e724/app-with-btns.png 2880w\"\n        sizes=\"(max-width: 750px) 100vw, 750px\"\n      />\n  </span>\n  </a></p>\n<blockquote>\n<p>Huomaa, että propseja voi välittää komponentille myös toisella tavalla: sen sijaan, että propsit annetaan komponentille aaltosulkeissa kuten yllä <code class=\"language-text\">const Header = ({ title }) =&gt; {</code>, joskus ne näkee annettavan näin: <code class=\"language-text\">const Header = (props) =&gt; {</code>. Tämä tarkoittaa käytännössä samaa asiaa, mutta komponentin propsit ovat piilossa props-nimisessä JavaScript-objektissa. On huomattavasti selkeämpää eritellä komponentin propsit aaltosulkeissa, joten käytämme aina tätä tapaa. </p>\n</blockquote>\n<h2>State</h2>\n<p>Komponentille annettujen propsien lisäksi komponentilla voi olla oma sisäinen tilansa, eli <em>state</em>. Statea voidaan käyttää komponentin sisällä kuten propsejakin, mutta propseja ja statea ei sovi sekoittaa toisiinsa. Propsit ovat jotain mitä komponentille annetaan, kun taas state on jotain mitä komponentti hallitsee itse. Komponentti ei saa muuttaa \"vanhemmiltaan\" saatuja propseja suoraan, kun taas komponentin sisäistä statea saa muuttaa vapaasti. Toisaalta myöskään \"vanhemmalla\" ei ole pääsyä \"lapsi\"-komponenttinsa sisäiseen tilaan.</p>\n<p>State saadaan käyttöömme Reactin <code class=\"language-text\">useState</code>-funktiolla, joka tulee ensin importata seuraavasti:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'React'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Funktion toiminta on jokseenkin monimutkainen, vaikka staten käyttö itsessään on yksinkertaista. State saadaan käyttöön seuraavan näköisellä funktiokutsulla:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Tarkastellaan funktiokutsua tarkemmin. <code class=\"language-text\">useState</code>-funktio palauttaa kaksi arvoa, jotka tallennetaan muuttujiin <code class=\"language-text\">count</code> ja <code class=\"language-text\">setCount</code>. <code class=\"language-text\">const [count, setCount]</code> siis vastaanottaa <code class=\"language-text\">useState</code>-funktion palauttamat kaksi arvoa, ja asettaa toisen arvoista <code class=\"language-text\">count</code>-muuttujaan, ja toisen arvon <code class=\"language-text\">setCount</code>-muuttujaan. Järjestyksellä on tässä väliä, sillä ensimmäinen <code class=\"language-text\">useState</code>-funktion palauttama arvo on itse tila, eli state. Staten alkuarvo on sama mikä <code class=\"language-text\">useState</code>-funktiolle annetaan parametrina (tässä tapauksessa luku <code class=\"language-text\">1</code>). Funktion palauttama toinen arvo on funktio, jolla tilaa muutetaan. Muuttujien nimillä ei kuitenkaan ole mitään merkitystä, eli ylläoleva rivi koodia voisi olla esimerkiksi:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>kissa<span class=\"token punctuation\">,</span> koira<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Tämä saattaa vaikuttaa hankalalta, mutta esimerkki helpottanee kokonaisuuden ymmärtämistä:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// count saa yllä arvokseen 1, koska annamme useState-funktiolle parametrin 1</span>\n<span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// countin arvo on nyt 2, sillä setCount on funktio, joka muuttaa countin arvoa</span>\n<span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// countin arvo on nyt 5</span></code></pre></div>\n<p>Eli kun kutsumme <code class=\"language-text\">useState</code>-funktiota jollakin parametrilla, se yksinkertaisesti asettaa annetun parametrin tilaksi ja palauttaa sen ensimmäisenä arvonaan, ja toisena arvonaan se palauttaa funktion, jolla tilaa voi muuttaa. <code class=\"language-text\">useState</code>-funktiolle annettu parametri voi olla mitä tahansa, ja voimme nimetä palautetut arvot miksi haluamme - voisimme esimerkiksi nimetä ylläolevan esimerkin muuttujat <code class=\"language-text\">const [number, setNumber] = useState(1)</code>, ja ainoa mikä muuttuisi on nimet, joilla viittaamme tilaan ja muutamme sitä.</p>\n<p>Komponenteille tila annetaan heti komponenttien alussa, jotta olisi selkeää mitä tiloja komponentilla on. Esimerkiksi kuvitteellinen komponentti <code class=\"language-text\">Counter</code>, jolla on tila count, voitaisiin määritellä seuraavasti:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Counter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ylläoleva esimerkkikomponentti luo tilan <code class=\"language-text\">count</code> (joka saa alkuun arvokseen 1), jonka se palauttaa komponentin näkymänä. React haluaa, että tila määritellään heti komponentin alussa, joten kutsumme <code class=\"language-text\">useState</code>-funktiota heti ensimmäisenä komponentissa. Nyt komponentissa voitaisiin kutsua funktiota <code class=\"language-text\">setCount(3)</code>, jolloin komponentin näkymä päivittyisi automaattisesti. Vielä meillä ei kuitenkaan ole keinoa kutsuta <code class=\"language-text\">setCount</code>-funktiota komponentissa, vaan se esitellään seuraavassa osiossa.</p>\n<p><strong>Tehtävä:</strong> Lisää <code class=\"language-text\">App</code>-komponentille tila kutsumalla <code class=\"language-text\">useState</code>-funktiota komponentin alussa. Aseta <code class=\"language-text\">useState</code>-funktion palauttamat arvot muuttujiin <code class=\"language-text\">[pets, setPets]</code> ja alusta tilan arvoksi tyhjä lista <code class=\"language-text\">[]</code>.</p>\n<p><a href=\"/react-workshop-2/elinkaari/\">Seuraavaksi tutustumme komponentin elinkaareen, ja miten tilaa voidaan hyödyntää.</a></p>","frontmatter":{"title":"Tilanhallinta"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/tilanhallinta/"}}